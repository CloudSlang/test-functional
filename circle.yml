#   (c) Copyright 2016 Hewlett-Packard Development Company, L.P.
#   All rights reserved. This program and the accompanying materials
#   are made available under the terms of the Apache License v2.0 which accompany this distribution.
#
#   The Apache License is available at
#   http://www.apache.org/licenses/LICENSE-2.0
#
####################################################

# Inputs to this script:
#   - CSLANG_VERSION_TAG

general:
  artifacts:
    - "/workdir/cli/cslang/logs/execution.log"

machine:
  environment:
    WORKDIR: "${HOME}/workdir"
    CLI_PARENT_DIR: "${WORKDIR}/cli"
    CLI_DIR: "${CLI_PARENT_DIR}/cslang"
    CLI_EXECUTABLE: "${CLI_DIR}/bin/cslang"
    CLI_CONTENT: "${CLI_DIR}/content"
    CLI_CONFIGURATION: "${CLI_DIR}/configuration"
    TEST_CASES_DIR: "${HOME}/test_cases"
    TEST_CASES_CLI_DIR: "${TEST_CASES_DIR}/cli"
    TEST_CASES_CLI_INPUTS_DIR: "${TEST_CASES_CLI_DIR}/inputs_folder"
    TEST_CASES_CLI_INPUTS_SCRIPTS_DIR: "${TEST_CASES_CLI_DIR}/scripts"

dependencies:
  override:
    - 'echo "Build uses CloudSlang version: ${CSLANG_VERSION_TAG}"'

test:
  pre:
    - mkdir -p "${CLI_PARENT_DIR}"
    - > # download CLI
      wget "https://github.com/CloudSlang/cloud-slang/releases/download/${CSLANG_VERSION_TAG}/cslang-cli-with-content.zip" -O "${CLI_PARENT_DIR}/cslang-cli.zip"
      && unzip "${CLI_PARENT_DIR}/cslang-cli.zip" -d "${CLI_PARENT_DIR}"
      && chmod +x "${CLI_EXECUTABLE}"
  override:
    # sanity
    - ${CLI_EXECUTABLE} run --f ${CLI_CONTENT}/io/cloudslang/base/print/print_text.sl --i text=cli_works
    # CLI - inputs folder
    - >
      INPUTS_TARGET_DIR=${CLI_CONFIGURATION}/inputs
      INPUTS_SRC_DIR=${TEST_CASES_CLI_INPUTS_DIR}/resources/inputs
      CLI_EXECUTABLE=${CLI_EXECUTABLE}
      TEST_FLOW=${TEST_CASES_CLI_DIR}/cslang/inputs_folder.sl
      ${TEST_CASES_CLI_INPUTS_SCRIPTS_DIR}/inputs_folder.sh
